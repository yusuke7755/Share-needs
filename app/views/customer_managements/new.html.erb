<main>
<br>
<br>
  <h4>レポート登録</h4>

<%= form_with(model: @project, url: customer_managements_path, local: true) do |form| %>
  
  <% if @project.errors.any? %>
    <div id="error_explanation">
      <h2><%=  @project.errors.count %> <%= t('view.error') %></h2>
      <ul>
      <% @project.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= form.label :title  %><br>
    <%= form.text_field :title ,:placeholder => "例：システム提案・サポート対応・障害対応" %>
  </div>

  <br>
    <h4>部署：担当</h4>
<%= @employee.all.each do |f| %>
<%= form.text_field :name %>
<% category_options = @department.order(:id).map { |c| [c.name, c.id, data: { children_path: category_sub_categories_path(c) }] } %>
<%= form.select :category_id , category_options, { include_blank: true }, class: 'select-parent' %>
<% category_options = @employee.department.try(:name) || [] %>
<% sub_category_options = sub_categories.map { |c| [c.name, c.id] } %>
<%= form.select :sub_category_id, sub_category_options, { include_blank: true }, class: 'select-children' %>
<% end %>



<hr>
    <%= form.select :department_id, options_for_select(@department.all.map{|dpt| [( dpt.name ) , dpt.id]} , {selected: current_employee.department.id}), { include_blank: '選択してください'}  %> 

  <div>
    <table>
    <% @department.where(web_flg: true).all.each do |dm| %>
      <tr>
        <th>
          <%= dm.name %>
        </th>
          <td>
          <div>
            <% @employee.where(department_id: dm.id).all.each do |emp| %>

              <% if current_employee.id == emp.id  && current_employee.department_id == dm.id %>

                <%= form.radio_button :employee_id, emp.id, checked: true%>
                <%= emp.name %><br>
              <% else %>
                <%= form.radio_button :employee_id, emp.id %>
                <%= emp.name %><br>
              <% end %>
            <% end %>
          </div>
          </td>
      </tr>
    <% end %>
    </table>

  </div>
<br>
    <h4>企業名/お客様名</h4>

    <%= form.select :customer_id, options_for_select(@customer.all.map{|cst| [( cst.name ), cst.id]}) , { include_blank: '選択してください'} %> 

  <div>
    <table>
    <% @customer.all.each do |ct| %>
      <tr>
        <th>
        <label><%= ct.name %></label>
        </th>
          <td>
          <div>
            <% @customeruser.where(customer_id: ct.id).all.each do |usr| %>
              <%= form.radio_button :customeruser_id, usr.id %>
              <%= usr.name %><br>
            <% end %>
          </div>
          </td>
      </tr>
    <% end %>
    </table>
  </div>
<br>
    <h4>システム/機能</h4>

<%= form.select :package_id, options_for_select(@package.all.map{|pcg| [( pcg.name ) ,pcg.id]} ) , { include_blank: '選択してください'}  %> 
    <table>
    <% @package.all.each do |pcg| %>
      <tr>
        <th>
        <label><%= pcg.name %></label>
        </th>
          <td>
          <div>
            <% @feature.where(package_id: pcg.id).all.each do |ft| %>
              <%= form.radio_button :feature_id, ft.id %>
              <%= ft.name %><br>
            <% end %>
          </div>
          </td>
      </tr>
    <% end %>
    </table>
  </div>

  <br>
  <div>
    <p><%= form.label :priority %></p>
    <p><%= form.select :priority, Project.priorities.keys.map {|k| [I18n.t("enums.projects.priority.#{k}"), k]}, include_blank: "選択して下さい" %></p>
  </div> 
  <br>

  <div>
    <p><%= form.label :apoint_at %></p>
    <p><%= form.date_field(
          :apoint_at, id: "apoint_at", class: "form-control",
          use_month_numbers: true, # jan, febとかじゃなくて数字で月を表現
          start_year:     (Time.now.year), # 何年から表示させるか
          end_year:       (Time.now.year), # 何年まで表示させるか
          default:        Date.new(1989, 1, 1), # 最初に表示されている年月日
          date_separator: '/') # 年月日を仕切る文字
        %></p>
  </div>

  <div>
    <p><%= form.label :deadline %> (未入力可)</p>
    <p><%= form.date_field(
          :deadline, id: "deadline", class: "form-control",
          use_month_numbers: true, # jan, febとかじゃなくて数字で月を表現
          start_year:     (Time.now.year), # 何年から表示させるか
          end_year:       (Time.now.year), # 何年まで表示させるか
          default:        Date.new(1989, 1, 1), # 最初に表示されている年月日
          date_separator: '/') # 年月日を仕切る文字
        %></p>
  </div>

  <div>
    <%= form.label :description %><br>
    <%= form.text_area :description , size: "40x10" ,:placeholder => "内容を記載してください。(400文字)"%>
  </div>
  <%= form.submit "レポート作成"  %>
<% end %>
  <br>
<button type="button" class="btn btn-info"><%= link_to "戻る", customer_managements_path, id: "back_to_menu" %></button>
  <br>
  <br>
  <br>
  <br>
</main>
